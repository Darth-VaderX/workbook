# Модуль FS
____

<a href="#sync">Синхронная работа с fs</a><br>
<a href="#async">Acинхронная работа с fs</a><br>
<a href="#promises">Acинхронная работа с fs через Promises</a><br>

Для работы с файловой системой в NodeJS отвечает встроенный модуль __fs__, который необходимо импортировать:
```
import fs from 'fs';
import fs from 'fs/promises'; // скоращённый вариант для асинхронной работы
```
Каждый метод __fs__ существует в двух вариантах: синхронный и асинхронный.

## Синхронная работа с файловой системой
<span id="sync">Метод</span> __readFileSync__ - синхронное чтения файла и возврат его содержимого. Первым параметром он принимает путь к файлу, а вторым - кодировку файла, как правило это utf8.

```
let text = fs.readFileSync('readme.txt', 'utf8');
console.log(text);
```

Метод __writeFileSync__ - синхронная запись текста в файл. Первым параметром метод принимает путь к файлу, а вторым - текст, который нужно записать в этот файл.
```
fs.writeFileSync('readme.txt', 'text');
```
_Если файл уже существует, то его текст будет перезаписан. А если файл не существует - то он будет автоматически создан._
При работе с файловой системой могут возникать различные исключительные ситуации. Поэтому любую работу с файловой системой необходимо оборачивать в __try-catch__.

## Acинхронная работа с файловой системой

<span id="async">Метод</span> __readFile__ - испольуется для асинхронного чтения файла. Первым параметром принимает имя или путь к файлу, вторым параметром - кодировку, а третьим - коллбэк, который выполнится после чтения файла. В коллбэк следует передавать два параметра. В первый параметр попадет объект с ошибкой, если она произойдет, а во второй - текст прочитанного файла.
```
fs.readFile('readme.txt', 'utf8', function(err, data) {
	console.log(data);
});
```
Так код асинхронный, то исключительные ситуации нельзя поймать через __try-catch__. Для обработки исключений в коллбэке предназначен первый параметр. Этот параметр будет содержать null, если исключения не случилось, или объект с ошибкой, если исключение произошло.

Метод __writeFile__ - aсинхронная запись текста в файл. Первым параметром принимает имя или путь к файлу, вторым параметром - кодировку, а третьим - коллбэк.
```
fs.writeFile('readme.txt', 'text', function(err) {
	if (err) {
		console.log('ошибка');
	}
});
```

## Асинхронная работа через Promises
<span id="promises">Для</span> асинхронной работы с модулями `fs` можно работать через промисы с помощью свойства `promises`:

```
fs.promises.readFile('readme.txt', 'utf8').then(data => {
	console.log(data);
});
```
Задача: найти сумму чисел в 5 разных файлах и записать в новый.
```
const names = ['1.txt', '2.txt', '3.txt', '4.txt', '5.txt',];
const files = [];
names.forEach(item => files.push(fs.promises.readFile(`file${item}`)));
Promise.all(files).then(data => {
    return data.map(item => +item).reduce((res, item) => res + item)
}).then(data2 => {
    return fs.promises.writeFile('sum.txt', String(data2));
}).catch(error => {
    console.log('Ошибка')
})
```

## Асинхронная работа через async-await

Вместо __then__ можно использовать альтернативный синтаксис `async-await`. Тогда можно пользоваться асинхронным кодом также, как с синхронным.
```
async function func() {
	try {
		let data = await fs.promises.readFile('readme.txt', 'utf8');
		console.log(data);
	} catch (err) {
		console.log('что-то пошло не так');
	}
}

func();
```
[dirname](dir.md)<br>
[Node.JS](nodeJS.md)<br>
